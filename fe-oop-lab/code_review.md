Привіт.

Мене звати Андрій, я фе-девелопер на одному з найбільших Angular-проектів у цьому офісі.

Не вдаючись в деталі, наш проект - це симбіоз приблизно із 10 різноманітних апок, котрі живуть в одному репозиторії і розробляються приблизно такою ж кількістю тімок, загальною чисельністю близько 50-60 чоловік.

Працюючи всього над 2-3 із цих частинок, ми відчуваємо велику відповідальність за якість усього продукту.

Нема сенсу довго пояснювати, чому показник якості коду для нас є важливим і яку роль в цьому відіграє **код-ревю**.

Сьогодні ми просто поговоримо про те, яких принципів дотримуватись коли проводите код ревю, на що звертати увагу і що робити коли ситуація не так однозначна.

* **Підніміть, будь ласка, руку ті, хто регулярно ревюває код у себе на проектах.**

Окей, надіюся, ця інформація буде корисна не тільки новачкам, які лиш починаються займатися **код-ревю**, але й тим, хто вже має у цьому досвід.

===

Рекомендації на цих слайдах базуються на Google's Engineering Practices Documentation, яка відображає досвід, накопичений інженерними командами **Гугл** протягом довгих років.

---

Отож, основна мета процесу **код-ревю** - переконатися, що загальна якість кодової бази з часом покращується.

---

Проте, щоб цього досягти, потрібно віднайти баланс між рядом принципів.

===

З одного боку, девелопери повинні мати змогу виконувати свої таски. Якщо ніколи не сабмітати імпрувменти в код-бейз, код-бейз ніколи не імпрувнеться.

Крім того, якщо ревю проходить так, що будь-які зміни запушити дуже важко, девелопер демотивується ці зміни робити в мабутньому.

===

З іншого боку, обовязок ревювера - переконатися, що кожен пул ріквест є достатньо якісним, щоб з часом не погіршувати загальний стан кодової бази.

Цей пункт може бути не таким і простим. Часто загальна якість коду деградує від невеликих поступків, які з часом накопичуються як лавина.

---

Основний принцип Code-review в Гугл звучить так:
Ревювери повинні апрувнути пул-ріквест
як тільки він доходить до стану коли точно покращує загальну якість кодової бази.
Навіть якщо він досі не ідеальний.

Ключовий момент у тому, що не існує ідеального коду, є тільки кращий код.
Замість того, щоб вимагати в автора коду відполірувати його найменші кусочки, варто зважити важливість внесення того прогресу, який пропонує даний пул-ріквест.

---
З іншого боку, ревювер завжди повинен мати змогу лишити комент про те, що щось може бути зроблено краще, але це не обовязково.

===

Для цього до коменту можна додати префікс як наприклад Nit.

Крім цього, коментарі з таким префіксом можуть слугувати і для навчання. **Код-ревю** - ефективний спосіб передати або здобути знання про мову, фреймворк чи архітектурні принципи на практиці.

Залишити комент, який допоможе автору навчитися чогось нового - це гарна ідея, яка з часом призводить до покращення загальної якості коду в проекті.

---

Давайте поговоримо про основні принципи, котрими треба керуватися при проведенні **код-ревю**.

===

Перше і найважливіше: технічні факти і дані завжди важливіші за думки й особисті вподобання.

===

В питаннях, что стосуються стилю, абсолютний авторитет - це СТАЙЛ-ГАЙД мови чи фреймворка, на якому ви пишете або будь-який інший, прийнятий у вас на проекті.
Крім того, стиль нового коду повинен бути консистентним з тим, що вже існує в кодовій базі.
Якщо стилю досі немає - приймається стиль написання автора.

===

Аспекти архітектури практично ніколи не є питаннями стилю чи особистих уподобань.
Вони базуються на основоположних принципах розробки ПЗ і повинні бути зважені відносно цих принципів, а не базуючись лише на чиїйсь думці.
Іноді буває важко виділити один абсолютно правильний підхід до вирішення якоїсь проблеми.
В такому випадку, автор може сам зважити і продемонструвати різні підходи (через дані або базуючись на основоположних принципах розробки ПЗ).
Якщо ж показані рішення є рівнозначно правильними, автор самостійно вибрати одне із них.
В іншому випадку у виборі потрібно керуватися стандартнимим принципами розробки ПЗ.

===

В кінці кінців, якщо ніякі інші правила не знаходять застосування, ревювер може попросити автора бути консистетним з тим, що вже є в проекті, якщо, звичайно, це не погіршує загальну якість коду системи.

---

Тепер давайте поговоримо про те, на що треба звертати увагу коли ревюваєте чийсь пул-ріквест.

Архітектура.

Найважливіша річ, яку має покрити ваше ревю - загальна архітекута.
Перевіряємо чи правильно взаємодіють між собою куски коду і чи правильно вони інтегруються в ваш проект.

===

Функціональність.

Тут потрібно переконатися, що код виконує саме те, для чого він був призначений і чи несе це користь для користувачів (як кінцевих, так і інших девелоперів).
По ідеї, ще до того, як попасти на ревю, девелопер сам має відтестувати свій код.
Тим не менше, ревювер, перечитуючи код, теж повинен думати про можливі проблеми і баги. Наприклад, прикинути як буде працювати код на едж кейсах.

У випадку, якщо ПР вносить серйозні зміни в юайку, оцінити їх з одного лише коду важко. В такому випадку бажано стягнути собі гілку автора і запустити проект з його змінами.
В крайньому випадку можна попросити автора ці зміни продемонструвати.

===

Складність.

Важливо переконатися, що код є не складнішим, ніж це потрібно. Треба перевірити його на всіх рівнях абстракцій: окремі рядки, функції, класи, модулі тощо.
Надто складний код - це такий код, який важко розібрати, просто читаючи.
Крім того це значить, що девелопери, які його міняють чи просто використовують, мають всі шанси завести і пару нових багів.

Особливим випадком складності коду є оверінжінірінг. Це стан коли девелопер робить код універсальнішим ніж потібно або вносить функціонал, в якому потреби фактично немає.
Це пастка, в якому зазвичай попадають тільки хороші девелопери і на це треба звертати серйозну увагу.
Я сам не раз люблю спекулювати на тому, що мій код можливо колись вирішить якусь-там проблему, крім того, для чого був початково призначений.
Як правило, проблеми треба вирішувати по мірі їх надходження, коли чітко видно їх суть і вимоги.

===

Тести.

Всі знають, що тести потрібно писати разом із кодом, хоча на жаль, так не завжди получається.
Тести повинні бути корисними і розумними. Тести на тести не пишуться, тому вся відповідальніть лежить на ревюверах.

Потрібно пересвідчитись, що тести щось дійсно тестують і не пройдуть якщо код поламається.
Кожен тест повинен містити просту і обовязково корисну перевірку.

Тести, як і весь інший код, потрібно також підтримувати. Не варто в тестах іти на будь-які компроміси тільки тому, що це не частина системи.

===

Неймінг.

Все повинно мати чіткі і зрозумілі імена.
Хороші імена мають бути достатньо довгими, щоб описати сутність або її поведінку і при тому не важко читатись.

===

Коментарі.

Зазвичай коменти є корисними коли вони пояснюють для чого існує той чи інший код, а не описують, що цей код робить.
В ідеалі код має пояснювати себе сам.
Хоча, є і винятки. Наприклад, регулярні вирази чи складні алгоритми, які тільки виграють від цих коментів.
Як правило, коментарі мають містити те, що неможливо виразити в коді, наприклад обгрунтування того чи іншого рішення.

===

Стиль.

Якщо це описано в стайл-гайді, то це просто маст-хев. Якщо це питання особистого вподобання, можна залишити найс-ту-хев ноут (НІТ).
Рефакторінг і функціональні зміни краще не мішати. Це ускладнить не тільки читабельність самого пул-ріквесту, а й можливість відкотити його при потребі.

===

Переглядай кожен рядок.

Автогенерований код, дата файли чи великі структури даних можна просто просканувати очима.
Все, що написано живим девом, треба ретельно перечитати.
Звичайно, вникнути у бізнес-логіку буває важко, але розуміти що робить той чи інший код необхідно.
Якщо зрозуміти його направду важко, є сенс попросити автора його пояснити, можливо навіть спростити або хоча б залишити пояснювальні комменти.

====

Хороші моменти.

Зазвичай код-ревю - це про критику і помилки.
Тим не менше, було би круто внести в них елемент заохочення і вдячності автору, особливо якщо він приділив багато зусиль твоємо коментарю.
Часто навіть в плані навчання чи новледж шарінгу корисніше вказати людині на те, що вона зробила правильно, ніж на те, що не правильно.


---
Отже, переглядаємо кожен рядок коду, перевіряємо архітектурні рішення, переконуємось, що якість коду росте і не жаліємо компліментів, коли це доречно.

Дякую за увагу.
Більше інформації за посиланням, яке зображено на екрані.
